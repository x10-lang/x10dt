<project name="X10DT Release Build Setup" basedir="." default="main">

	<target name="check-eclipse-existence">
		<available file="${basedir}/../eclipse" type="dir" property="is-eclipse-present" />
	</target>

	<target name="download-eclipse" depends="check-eclipse-existence" unless="is-eclipse-present">
		<startBuildActivity repositoryAddress="${repositoryAddress}" userId="${userId}" passwordFile="${passwordFile}"
						    activityIdProperty="download-eclipse" label="Downloading eclipse..."
						    buildResultUUID="${buildResultUUID}" autoComplete="true" />
						            	
		<propertyregex property="eclipse.name" input="${eclipse.url}" regexp=".*\/(.*\.tar\.gz)" select="\1" casesensitive="false" />
		<propertyregex property="eclipse.dir.name" input="${eclipse.name}" regexp="(.*)\.tar\.gz" select="\1" casesensitive="false" />
		<get usetimestamp="yes" src="${eclipse.url}" dest="${basedir}/../${eclipse.name}" />
		<gunzip src="${basedir}/../${eclipse.name}" dest="${basedir}/../eclipse.tar" />
		<untar src="${basedir}/../eclipse.tar" dest="${basedir}/.." />
		<delete file="${basedir}/../eclipse.tar" />
	</target>

	<target name="check-delta-pack-existence">
		<available file="${basedir}/../delta-pack" type="dir" property="is-delta-pack-present" />
	</target>

	<target name="download-delta-pack" depends="check-delta-pack-existence" unless="is-delta-pack-present">
		<startBuildActivity repositoryAddress="${repositoryAddress}" userId="${userId}" passwordFile="${passwordFile}"
					        activityIdProperty="download-delta-pack" label="Downloading delta pack..." 
					        buildResultUUID="${buildResultUUID}" autoComplete="true" />
		
		<propertyregex property="delta.pack.name" input="${delta.pack.url}" regexp=".*\/(.*\.zip)" select="\1" casesensitive="false" />
		<get usetimestamp="yes" src="${delta.pack.url}" dest="${basedir}/../${delta.pack.name}" />
		<unzip src="${basedir}/../${delta.pack.name}" dest="${basedir}/../delta-pack" />
	</target>
	
	<target name="main" depends="download-eclipse,download-delta-pack"/>

</project>
