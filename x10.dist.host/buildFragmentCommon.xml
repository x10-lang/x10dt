<?xml version="1.0" encoding="UTF-8"?>

<project name="x10.dist.host" default="update" basedir=".">
<!-- from original build.xml by Igor-->
    <property name="tmp" location="${basedir}/tmp"/>
    <property name="incdir" location="${basedir}/include"/>
    <property name="lib" location="${basedir}/lib"/>
	<!-- Bump version here: for 2.0.3-->
    <property name="x10.version" value="2.0.3"/>
    <property name="orig.x10.timestamp" value="${x10.version}"/> <!-- override if version is, e.g., "svn head" -->
	<property name="x10.tarball.timestamp" value="13775" />
	<property name="x10.timestamp" value="tib_${x10.tarball.timestamp}"/>
    <!-- sample value from fragment: <property name="x10.platform" value="linux_x86_64"/> -->
    <property name="x10.dist.location" location="${tmp}"/>
	<!-- start: changed for 2.0.3-->
	<property name="x10.tarball" value="x10-${x10.timestamp}_${x10.platform}.tgz"/> 
    <property name="orig.x10.tarball.url" value="http://sourceforge.net/projects/x10/files/${x10.version}/${x10.tarball}?use_mirror=voxel"/>
	<!-- temporary tarball locn on orquesta for testing -->
	<property name="x10.tarball.url" value="http://orquesta.watson.ibm.com/x10dt/x10-builds/${x10.tarball.timestamp}/${x10.tarball}"/>
	<!--     actual value                   http://orquesta.watson.ibm.com/x10dt/x10-builds/13749/x10-tib_13749_cygwin_x86.tgz -->
	<!-- end:   changed for 2.0.3-->
    <property name="x10.transport" value="sockets"/>
    <!-- get the environment variables -->
    <property environment="env"/>
    <target name="init">
        <tstamp/>
        <mkdir dir="${tmp}"/>
        <mkdir dir="${incdir}"/>
        <mkdir dir="${lib}"/>
        <condition property="x10.already.expanded" value="true">
            <not>
                <equals arg1="${x10.dist.location}" arg2="${tmp}"/>
            </not>
        </condition>
        <condition property="local.x10.tarball" value="${env.LOCAL_X10_TARBALL}">
            <or>
                <isset property="env.LOCAL_X10_TARBALL"/>
                <isset property="x10.already.expanded"/>
            </or>
        </condition>
    </target>
    <target name="clean">
    	<!--  note: for 2.0.4, just use/delete everything from platform tarballs, not specific files or patterns  -->
        <delete>
            <fileset dir="${lib}">
                <include name="lib*.a"/> 
            	<include name="lib*.so*"/>  <!-- 2.0.2: linux now has shared libs not .a's -->
                <include name="*.dll"/>  <!-- cygwin has DLLs  -->                
                <include name="libx10.mft"/>
            	<exclude name="dummy.file"/>
            </fileset>
        </delete>
        <delete>
            <fileset dir="${incdir}">
                <include name="*.h"/>
                <include name="**/*.h"/>
                <include name="*.inc"/>
                <include name="**/*.inc"/>
                <exclude name="dummy.file"/>
            </fileset>
        </delete>
        <delete dir="${incdir}/x10"/>
        <delete dir="${incdir}/x10aux"/>
        <delete dir="${tmp}/include"/>
        <delete dir="${tmp}/lib"/>
    </target>
    <target name="distclean" depends="clean">
        <delete dir="${tmp}"/>
    </target>
    <target name="x10-tarball-download" depends="init" unless="local.x10.tarball">
        <mkdir dir="${tmp}"/>
        <get usetimestamp="true" ignoreerrors="true" src="${x10.tarball.url}" dest="${tmp}/${x10.tarball}"/>
        <property name="local.x10.tarball" location="${tmp}/${x10.tarball}"/>
    </target>
	 <target name="x10-tarball-test-values" depends="init" >
        <echo message="x10.tarball.url=${x10.tarball.url}; dest=${tmp}/${x10.tarball}"/>
	    </target>
    <target name="expand-x10-tarball" depends="init,x10-tarball-download" unless="x10.already.expanded">
    	<!--  note: for 2.0.4, just use/delete everything from platform tarballs, not specific files or patterns  -->
        <untar src="${local.x10.tarball}" dest="${tmp}" compression="gzip">
            <patternset>
                <include name="include/**"/>
                <include name="lib/lib*.a"/>
            	<include name="lib/lib*.so*"/>  <!-- 2.0.2: linux now has shared libs not .a's -->
                <include name="lib/*.dll"/><!--  2.0.2 cygwin has libgc.dll.a-->
                <include name="lib/libx10.mft"/>
            </patternset>
        </untar>
    </target>
    <target name="download" depends="init,x10-tarball-download"/>
    <target name="expand" depends="init,expand-x10-tarball"/>
    <target name="update" depends="init,expand">
        <echo message="${ant.project.name}: ${ant.file}"/>
        <copy todir="${incdir}">
            <fileset dir="${x10.dist.location}/include" includes="**"/>
        </copy>
        <copy todir="${lib}"> <!-- 2.0.2: copy .so files too - linux uses shared lib .so* files -->
        	<!--  note: for 2.0.4, just use/delete everything from platform tarballs, not specific files or patterns  -->
            <fileset dir="${x10.dist.location}/lib" includes="lib*.a,lib*.so*,*.dll,libx10.mft,"/><!-- 2.0.2-->
        </copy>
    </target>
    <target name="dist" depends="init,update"/>
</project>
<!-- vim:tabstop=4:shiftwidth=4:expandtab
-->
