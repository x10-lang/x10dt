<?xml version="1.0" encoding="UTF-8"?>
<project name="x10DTCommon" basedir=".">
    <property name="basews" value="${ws}"/>
    <property name="baseos" value="${os}"/>
    <property name="basearch" value="${arch}"/>
    <property name="basenl" value="${nl}"/>

    <!-- Compiler settings. -->
    <property name="javacFailOnError" value="true"/>
    <property name="javacDebugInfo" value="on"/>
    <property name="javacVerbose" value="false"/>

    <echo message="java.home = ${java.home}"/>
    <echo message="ant.home = ${ant.home}"/>

	<tstamp>
		<format property="build.time" pattern="yyyyMMddHHmm"/> 
	</tstamp>
	<condition property="x10dt.build.qualifier" value="v${build.time}">
		<not>
			<isset property="x10dt.build.qualifier"/>
		</not>
	</condition>

	<!-- Following assumes we're invoking the build from within some plugin project's top-level directory -->
    <xmlproperty file="../org.eclipse.imp.x10dt.feature/feature.xml" prefix="x10dt"/>

	<propertyRegexp name="x10dt.version" input="${x10dt.feature(version)}" regexp="(.*).qualifier" value="\1.${x10dt.build.qualifier}"/>

	<echo message="Building for X10DT version ${x10dt.version}"/>

    <condition property="mac.jre.path" value="${java.home}/../Classes">
        <os family="mac"/>
    </condition>

    <condition property="mac.jre.path" value="">
        <not> <os family="mac"/> </not>
    </condition>

    <echo message="mac.jre.path = ${mac.jre.path}"/>

    <path id="path_bootclasspath">
        <fileset dir="${mac.jre.path}">
            <include name="*.jar"/>
        </fileset>
        <fileset dir="${java.home}/lib">
            <include name="*.jar"/>
        </fileset>
	<fileset dir="${ant.home}/lib">
            <include name="*.jar"/>
        </fileset>
    </path>

    <property name="bootclasspath" refid="path_bootclasspath"/>

    <fail unless="x10dt.eclipse.target" message="You must define x10dt.eclipse.target as the location of the Eclipse installation against which X10DT should be built."/>

    <echo message="x10dt.eclipse.target = ${x10dt.eclipse.target}"/>

    <path id="path_eclipse.build.path">
        <fileset dir="${x10dt.eclipse.target}/plugins">
            <include name="**/*.jar"/>
        </fileset>
    </path>
    <pathconvert property="eclipse.build.path" refid="path_eclipse.build.path" targetos="unix"/>
</project>
