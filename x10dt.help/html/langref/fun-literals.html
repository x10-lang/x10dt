<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<html>
<head>
<meta name="GENERATOR" content="TtH 3.80">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
 <style type="text/css"> div.p { margin-top: 7pt;}</style>
 <style type="text/css"><!--
 td div.comp { margin-top: -0.6ex; margin-bottom: -1ex;}
 td div.comb { margin-top: -0.6ex; margin-bottom: -.6ex;}
 td div.hrcomp { line-height: 0.9; margin-top: -0.8ex; margin-bottom: -1ex;}
 td div.norm {line-height:normal;}
 span.roman {font-family: serif; font-style: normal; font-weight: normal;} 
 span.overacc2 {position: relative;  left: .8em; top: -1.2ex;}
 span.overacc1 {position: relative;  left: .6em; top: -1.2ex;} --></style>
<title>Function literals</title>
</head>

<body>
 <h2><a name="tth_sEc2">
2</a>&nbsp;&nbsp;Function Literals</h2>

<a name="FunctionLiteral">
</a>

<div class="p"><!----></div>
X10 provides first-class, typed functions, including
<em>closures</em>, <em>operator functions</em>, and <em>method
  selectors</em>.

<div class="p"><!----></div>
<em>  
<table>

<tr><td align="right">ClosureExp ::= FormalParams WhereClause<sup>?</sup>&nbsp;HasResultType<sup>?</sup>&nbsp;Offers<sup>?</sup>&nbsp;<b>=&#62;</b> ClosureBody </td></tr>
<tr><td align="right">FormalParams ::= <b>(</b> FormalParamList<sup>?</sup>&nbsp;<b>)</b> </td></tr>
<tr><td align="right">WhereClause ::= DepParams </td></tr>
<tr><td align="right">DepParams ::= <b>{</b> ExistentialList<sup>?</sup>&nbsp;Conjunction<sup>?</sup>&nbsp;<b>}</b> </td></tr>
<tr><td align="right">ExistentialList ::= FormalParam </td></tr>
<tr><td align="right">&#124; ExistentialList <b>;</b> FormalParam </td></tr>
<tr><td align="right">HasResultType ::= <b>:</b> Type </td></tr>
<tr><td align="right">&#124; <b>&lt;:</b> Type </td></tr>
<tr><td align="right">ClosureBody ::= ConditionalExp </td></tr>
<tr><td align="right">&#124; Annotations<sup>?</sup>&nbsp;<b>{</b> BlockStatements<sup>?</sup>&nbsp;LastExp <b>}</b> </td></tr>
<tr><td align="right">&#124; Annotations<sup>?</sup>&nbsp;Block </td></tr>
<tr><td align="right"></td></tr></table>
</em>

<div class="p"><!----></div>
Functions have zero or more formal parameters and an optional return type.
The body has the 
same syntax as a method body; it may be either an expression, a block
of statements, or a block terminated by an expression to return. In
particular, a value may be returned from the body of the function
using a return statement (&#167;). 

<div class="p"><!----></div>
The type of a function is a function type as described in &#167;.  In some
cases the 
return type <b>T</b> is also optional and defaults to the type of the
body. If a formal <b>xi</b> does not occur in any
<b>Tj</b>, {c}, <b>T</b> or {e}, the declaration <b>xi:Ti</b> may
be replaced by just <b>Ti</b>. <em>E.g.</em>,  <b>(Int)=&#62;7</b> is the integer function returning
7 for all inputs.

<div class="p"><!----></div>
<a name="ClosureGuard">
</a>As with methods, a function may declare a guard to
constrain the actual parameters with which it may be invoked.
The guard may refer to the type parameters, formal parameters,
and any <b>val</b>s in scope at the function expression.

<div class="p"><!----></div>
<pre>
    val n = 3;
    val f : (x:Int){x != n} =&#62; Int  
          = (x:Int){x != n} =&#62; (12/(n-x));
    Console.OUT.println("f(5)=" + f(5));    
</pre>

<div class="p"><!----></div>
The body of the function is evaluated when the function is
invoked by a call expression (&#167;), not at the function's
place in the program text.

<div class="p"><!----></div>
As with methods, a function with return type <b>void</b> cannot
have a terminating expression. 
If the return type is omitted, it is inferred, as described in
&#167;.
It is a static error if the return type cannot be inferred.  <em>E.g.</em>,
<b>(Int)=&#62;null</b> is not well-specified; X10 does not know which type of
<b>null</b> is intended.  
But <b>(Int):Array[Double](1) =&#62; null</b> is legal.

<div class="p"><!----></div>
The following method takes a function parameter and uses it to
test each element of the list, returning the first matching
element.  It returns <b>absent</b> if no element matches.

<div class="p"><!----></div>
<pre>

<div class="p"><!----></div>
def find[T](f: (T) =&#62; Boolean, xs: List[T], absent:T): T = {
  for (x: T in xs)
    if (f(x)) return x;
  absent
  }
</pre>

<div class="p"><!----></div>
The method may be invoked thus:
<pre>
xs: List[Int] = new ArrayList[Int]();
x: Int = find((x: Int) =&#62; x&#62;0, xs, 0);
</pre>

<div class="p"><!----></div>
     <h3><a name="tth_sEc2.1">
2.1</a>&nbsp;&nbsp;Outer variable access</h3>


<div class="p"><!----></div>
In a function
"(x<sub>1</sub>: T<sub>1</sub>, ..., x<sub>n</sub>: T<sub>n</sub>){c} =&#62; { s }"
the types , the guard <b>c</b> and the body <b>s</b>
may access many, though not all, sorts of variables from outer scopes.  
Specifically, they can access: 

<ul>
<li> All fields of the enclosing object(s) and class(es);
<div class="p"><!----></div>
</li>

<li> All type parameters;
<div class="p"><!----></div>
</li>

<li> All <b>val</b> variables;
<div class="p"><!----></div>
</li>
</ul>

<b>var</b> variables cannot be accessed.

<div class="p"><!----></div>
The function body may refer to instances of enclosing classes using
the syntax <b>C.this</b>, where <b>C</b> is the name of the
enclosing class.  <b>this</b> refers to the instance of the immediately
enclosing class, as usual.

<div class="p"><!----></div>
<em>E.g.</em> The following is legal.  
However, the commented-out line would not be legal.
Note that <b>a</b> is not a local <b>var</b> variable. It is a field of
<b>this</b>. A reference to <b>a</b> is simply short for <b>this.a</b>, which is
a use of a <b>val</b> variable (<b>this</b>).  
<pre>
class Lambda {
   var a : Int = 0;
   val b = 0;
   def m(var c : Int, val d : Int) {
      var e : Int = 0;
      val f : Int = 0;
      val closure = (var i: Int, val j: Int) =&#62; {
    	  return a + b + d + f + j + this.a + Lambda.this.a;
          // ILLEGAL: return c + e + i;
      };
      return closure;
   }
}
</pre>

<div class="p"><!----></div>
<pre>
</pre>

<div class="p"><!----></div>

<div class="p"><!----></div>

<div class="p"><!----></div>

</body>
</html>