<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<html>
<head>
<meta name="GENERATOR" content="TtH 3.80">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
 <style type="text/css"> div.p { margin-top: 7pt;}</style>
 <style type="text/css"><!--
 td div.comp { margin-top: -0.6ex; margin-bottom: -1ex;}
 td div.comb { margin-top: -0.6ex; margin-bottom: -.6ex;}
 td div.hrcomp { line-height: 0.9; margin-top: -0.8ex; margin-bottom: -1ex;}
 td div.norm {line-height:normal;}
 span.roman {font-family: serif; font-style: normal; font-weight: normal;} 
 span.overacc2 {position: relative;  left: .8em; top: -1.2ex;}
 span.overacc1 {position: relative;  left: .6em; top: -1.2ex;} --></style>
	<title>Principles of X10 Objects</title>
</head>

<body>
 <h2><a name="tth_sEc1">
1</a>&nbsp;&nbsp;Principles of X10 Objects</h2><a name="XtenObjects">
</a>

<div class="p"><!----></div>
     <h3><a name="tth_sEc1.1">
1.1</a>&nbsp;&nbsp;Basic Design</h3>

<div class="p"><!----></div>
Objects are instances of classes: the most common and most powerful sort of
value in X10.  The other kinds of values, structs and functions, are more
specialized, better in some circumstances but not in all.
<b>x10.lang.Object</b> is the most general class; all other classes inherit
from it, directly or indirectly. 

<div class="p"><!----></div>
Classes are structured in a single-inheritance code
hierarchy, may implement multiple interfaces, may have static and
instance fields, may have static and instance methods, may have
constructors, may have static and instance initializers, may have
static and instance inner classes and interfaces. X10 does not
permit mutable static state.

<div class="p"><!----></div>
Unlike Java, X10 objects do not have locks associated with them.
Programmers should use atomic blocks (&#167;) for mutual
exclusion and clocks (&#167;) for sequencing multiple parallel
operations.

<div class="p"><!----></div>
<b>Object</b> has one property <b>home</b> of type
<b>x10.lang.Place</b>, telling where the object is located.
Objects stay resident at the place at which they were created for their entire
lifetime. However, the programmer may designate certain immutable field of an
object as <b>global</b>, accessible from everywhere.

<div class="p"><!----></div>
Activities at places other than <b>ob.home</b> are allowed to have references
to object <b>ob</b>.   These <em>remote references</em> do not grant all the
privileges of a local reference; only <b>ob</b>'s <b>global</b> methods and
fields are usable remotely. An X10
implementation should try to ensure that the creation of a second or
subsequent reference to the same remote object at a given place does
not incur any (additional) communication cost.

<div class="p"><!----></div>
A reference to an object carries with it the values of  <b>global</b> <b>val</b>
fields 
of the object. The implementation should try to ensure that the cost
of communicating the values of <b>val</b> fields of an object from the
place where it is hosted to any other place is not incurred more than
once for each target place.

<div class="p"><!----></div>
X10 does not have an operation (such as Pascal's "dereference"
operation) which returns an object given a reference to the
object. Rather, most operations on object references are transparently
performed on the bound object, as indicated below. The operations on
objects and object references include:

<ul>
<li> Field access (&#167;). 
All fields can be accessed locally; only <b>global</b> fields can be accessed
remotely.   <b>global</b> fields are more expensive than non-<b>global</b> ones,
and should be used sparingly as needed.  Properties are global fields.

<div class="p"><!----></div>

<div class="p"><!----></div>
</li>

<li> Method invocation (&#167;).  
<a name="GlobalAnnotation">
</a>
All methods can be accessed locally; only <b>global</b> methods can be accessed
remotely.  <b>global</b> methods are no more expensive than local ones, and can
be used freely where possible.  However, <b>global</b> methods can only perform
a subset of operations (&#167;).

<div class="p"><!----></div>

<div class="p"><!----></div>
</li>

<li> Casting (&#167;) and instance testing with <b>instanceof</b>
(&#167;) Objects can be cast or tested either locally or remotely.
These operations involve the class and the object's properties, both of which
are available globally.
<div class="p"><!----></div>
</li>

<li> The equality operators <b>==</b> and <b>!=</b>
(&#167;). On creation, each object is associated with a globally
unique identifier. Two object references are <b>==</b> iff they refer to objects
with the same identifier.
<div class="p"><!----></div>
</li>
</ul>

<div class="p"><!----></div>
     <h3><a name="tth_sEc1.2">
1.2</a>&nbsp;&nbsp;Distributed Object Model</h3>

<div class="p"><!----></div>
The state of an object is partitioned into <em>global</em> state (a
programmer defined subset of <b>val</b> fields, &#167;) and
<em>non-global</em> state.  Global state is available from anywhere without
communication at the time of reference; non-global state is only available
directly from the object's home place. 

<div class="p"><!----></div>
 
<ul>
<li> Field definitions are marked with the qualifier <b>global</b> if
  they are intended to be included in the global state.
<div class="p"><!----></div>
</li>

<li> If the <b>global</b> qualifier is omitted, the field is
  considered non-global.
<div class="p"><!----></div>
</li>

<li> Properties and static fields are implicitly marked <b>global</b>.
<div class="p"><!----></div>
</li>

<li> <b>var</b> fields cannot be marked <b>global</b>.

<div class="p"><!----></div>
</li>
</ul>

<div class="p"><!----></div>
Similarly, the methods of an object may be qualified as
<b>global</b>(&#167;) ; if they are not global they are
said to be <em>non-global</em>. 
Global methods cannot be overridden by non-global methods.

<div class="p"><!----></div>
Consider the execution of an <b>at (P) S</b> statement at a place
<b>Q</b> different from <b>P</b>. Suppose <b>x</b> is an in-scope
immutable local variable and contains a reference to an object <b>o</b>
created at <b>Q</b>. Then within <b>S</b>, <b>x</b> is said to be a
<em>remote reference</em> to <b>o</b>. References to <b>o</b> from place
<b>Q</b> are said to be <em>local references</em>. X10 permits
<b>global</b> fields to be read and <b>global</b> methods to be invoked
through a remote reference.

<div class="p"><!----></div>
Like local references, remote references are first-class entities:
they may be passed as arguments to methods, returned from methods,
stored in fields of objects.

<div class="p"><!----></div>
Remote references may also be compared for equality (<b>==</b>). Two
remote reference are equal if they are references to the same
object. Equality is guaranteed to be a constant-time operation and not
involve any communication.

<div class="p"><!----></div>
When a remote reference to an object <b>o</b> located at place <b>P</b> is
transmitted to <b>P</b> it automatically becomes a local reference to
<b>o</b>. Therefore the situation in which a local reference can be compared
to a remote reference simply cannot arise.

<div class="p"><!----></div>
The X10 compiler ensures that non-global methods on <b>o</b> can
only be invoked in a place where <b>here == o.home()</b>, i.e. the place
where <b>o</b> was created.

<div class="p"><!----></div>

<b>Implementation notes&nbsp;&nbsp;</b>
Remote references to an object <b>o</b> are intended to be implemented by
serializing the global state of <b>o</b> and sending it across the network,
together with a globally unique id. The data is deserialized at the receiver
to create an implementation-level entity that is the remote reference.
There is no requirement that a remote reference use only as much space as a
local reference; , it is possible that remote references have space for
global data, and local references do not.

<div class="p"><!----></div>
         <h3><a name="tth_sEc1.3">
1.3</a>&nbsp;&nbsp;Examples of Local and Remote References</h3>
Given the class declarations: 
<pre>
class C { } 
class D {
   var f:C=null;
}
</pre>

<div class="p"><!----></div>
Let <b>P</b> and <b>Q</b> be different places, neither equal to <b>here</b>.
Then all of the <b>truly(b)</b>'s in the following code have <b>b==true</b>.
The locality of references is described in comments.
<pre>

<div class="p"><!----></div>
val x = new C(); 
// C object o1 created, local reference stored in x. 
at (P) { 
      // In the body x contains a remote reference to o1
      val d = new D();
      d.f  = x; // remote reference stored in d.f
      truly(d.f == x);        
      truly(x == x);          
      at (Q) { 
         // x continues to be a remote reference to o1.
         at (P) {  
             truly(d.f == x); 
             truly(x == x);   
         }
      }
}
</pre>

<div class="p"><!----></div>
Here is another example.
<pre>
val x = new C(); 
// C object o created, reference stored in x. 
// The type inferred for x is C!
at (P) { 
    val x1 = x; 
    // The type inferred for x1 is C, not C!;
    // the change is due to the place shift 'at(P)'
  at (x.home) {
        // x is now bound to o through a local reference. So is x1.
    Console.OUT.println(x1==x); // Must print true.
      // non-global methods can be invoked on x or x1 and will 
      // execute locally on o
      // type of both x and x1 is C!.
  }
}
</pre>

<div class="p"><!----></div>
     <h3><a name="tth_sEc1.4">
1.4</a>&nbsp;&nbsp;Class Declaration Syntax</h3>

<div class="p"><!----></div>
The <em>class declaration</em> has a list of type parameters, properties, a
constraint (the <em>class invariant</em>), a single superclass, zero or more
interfaces, and a class body containing the the definition of fields,
properties, methods, and member types. Each such declaration introduces a
class type (&#167;).

<div class="p"><!----></div>

<div class="p"><!----></div>

</body>
</html>