<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<html>
<head>
<meta name="GENERATOR" content="TtH 3.80">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
 <style type="text/css"> div.p { margin-top: 7pt;}</style>
 <style type="text/css"><!--
 td div.comp { margin-top: -0.6ex; margin-bottom: -1ex;}
 td div.comb { margin-top: -0.6ex; margin-bottom: -.6ex;}
 td div.hrcomp { line-height: 0.9; margin-top: -0.8ex; margin-bottom: -1ex;}
 td div.norm {line-height:normal;}
 span.roman {font-family: serif; font-style: normal; font-weight: normal;} 
 span.overacc2 {position: relative;  left: .8em; top: -1.2ex;}
 span.overacc1 {position: relative;  left: .6em; top: -1.2ex;} --></style>
	<title>Constructor definitions</title>
</head>

<body>
 <h2><a name="tth_sEc5">
5</a>&nbsp;&nbsp;Constructor definitions</h2>

<div class="p"><!----></div>
A constructor for a class "C" is guaranteed to return an object of the
class on successful termination. This object must satisfy i(C), the
class invariant associated with "C" ().
However,
often the objects returned by a constructor may satisfy <em>stronger</em>
properties than the class invariant.  X10's dependent type system
permits these extra properties to be asserted with the constructor in
the form of a constrained type (the "return type" of the constructor):

<div class="p"><!----></div>
<em>  
<table>
<tr><td align="right">ConstructorDeclarator &nbsp;::=&nbsp; 
  <tt>def this</tt> TypeParameterList<sup>?</sup>&nbsp;( FormalParameterList<sup>?</sup>&nbsp;) </td></tr>
<tr><td align="right"></td><td align="center"></td><td>ReturnType<sup>?</sup>&nbsp;Guard<sup>?</sup>&nbsp;Throws<sup>?</sup>&nbsp;</td></tr>
<tr><td align="right">ReturnType     &nbsp;::=&nbsp; : Type </td></tr>
<tr><td align="right">Guard     &nbsp;::=&nbsp; "" DepExpression "" </td></tr>
<tr><td align="right">Throws    &nbsp;::=&nbsp; <tt>throws</tt> ExceptionType  ( , ExceptionType )<sup>*</sup>&nbsp;</td></tr>
<tr><td align="right">ExceptionType  &nbsp;::=&nbsp; ClassBaseType Annotation<sup>*</sup>&nbsp;</td></tr>
<tr><td align="right"></td></tr></table>
</em>


<div class="p"><!----></div>
<a name="ConstructorGuard">
</a>The parameter list for the constructor
may specify a <em>guard</em> that is to be satisfied by the parameters
to the list.

<div class="p"><!----></div>
Here is another example.
<pre>
public class List[T](n: Int{n &#62;= 0}) {
    protected head: Box[T];
    protected tail: List[T](n-1);
    public def this(o: T, t: List[T]) : List[T](t.n+1) = { 
        n = t.n+1;
        tail = t;
        head = o;
    }
    public def this() : List[T](0) = {
        n = 0;
        head = null;
        tail = null;
    }
    ...
}
</pre>
The second constructor returns a "List" that is guaranteed to have
"n==0";
the first constructor is guaranteed to return a List with "n&#62;0"
(in fact, "n==t.n+1", where the argument to the constructor is "t"). 
This is recorded by the programmer in the constrained type associated with the
constructor.


<div class="p"><!----></div>
Super-invoke
   Let "C" be a class with properties
   "p<sub>1</sub>: P<sub>1</sub>, ..., p<sub>n</sub>: P<sub>n</sub>", invariant "c"
   extending the constrained type "D{d}" (where "D" is the name of a class).

<div class="p"><!----></div>
   For every constructor in "C" the compiler checks that the call to
   super invokes a constructor for "D" whose return type is strong enough
   to entail "d". Specifically, if the call to super is of the form 
     &#223;uper(e<sub>1</sub>, ..., e<sub>k</sub>)"
   and the static type of each expression &#235;<sub>i</sub>" is
   "S<sub>i</sub>", and the invocation
   is statically resolved to a constructor
"def this(x<sub>1</sub>: T<sub>1</sub>, ..., x<sub>k</sub>: T<sub>k</sub>){c}: D{d<sub>1</sub>}"
   then it must be the case that 
<pre>
x<sub>1</sub>: S<sub>1</sub>, ..., x<sub>i</sub>: S<sub>i</sub> |- x<sub>i</sub>: T<sub>i</sub>  (for i  <font face="symbol">Î</font
> {1, ..., k})
x<sub>1</sub>: S<sub>1</sub>, ..., x<sub>k</sub>: S<sub>k</sub> |- c  
d<sub>1</sub>[a/self] && x<sub>1</sub>: S<sub>1</sub> ... && x<sub>k</sub>: S<sub>k</sub> |- d[a/self]      
</pre>
 where &#228;" is a constant that does not appear in 
"x<sub>1</sub>: S<sub>1</sub> <font face="symbol">Ù</font
> ... <font face="symbol">Ù</font
> x<sub>k</sub>: S<sub>k</sub>".

<div class="p"><!----></div>
Constructor return
   The compiler checks that every constructor for "C" ensures that
   the properties "p<sub>1</sub>,..., p<sub>n</sub>" are initialized with values which satisfy
   "t(C)", and its own return type "c'" as follows.  In each constructor, the
   compiler checks that the static types "T<sub>i</sub>" of the expressions &#235;<sub>i</sub>"
   assigned to "p<sub>i</sub>" are such that the following is
   true:
<pre>
p<sub>1</sub>: T<sub>1</sub>, ..., p<sub>n</sub>: T<sub>n</sub> |- t(C) <font face="symbol">Ù</font
> c'     
</pre>

(Note that for the assignment of &#235;<sub>i</sub>" to "p<sub>i</sub>"
to be type-correct it must be the
    case that "p<sub>i</sub>: T<sub>i</sub> <font face="symbol">Ù</font
> p<sub>i</sub>: P<sub>i</sub>".) 

<div class="p"><!----></div>
Constructor invocation
The compiler must check that every invocation "C(e<sub>1</sub>, ..., e<sub>n</sub>)" to a
constructor is type correct: each argument &#235;<sub>i</sub>" must have a static type
that is a subtype of the declared type "T<sub>i</sub>" for the ith
argument of the
constructor, and the conjunction of static types of the argument must
entail the  in the parameter list of the constructor.


<div class="p"><!----></div>
</body>
</html>