<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<html>
<head>
<meta name="GENERATOR" content="TtH 3.80">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
 <style type="text/css"> div.p { margin-top: 7pt;}</style>
 <style type="text/css"><!--
 td div.comp { margin-top: -0.6ex; margin-bottom: -1ex;}
 td div.comb { margin-top: -0.6ex; margin-bottom: -.6ex;}
 td div.hrcomp { line-height: 0.9; margin-top: -0.8ex; margin-bottom: -1ex;}
 td div.norm {line-height:normal;}
 span.roman {font-family: serif; font-style: normal; font-weight: normal;} 
 span.overacc2 {position: relative;  left: .8em; top: -1.2ex;}
 span.overacc1 {position: relative;  left: .6em; top: -1.2ex;} --></style>
<title>Compiler plugins</title>
</head>

<body>
 <h2><a name="tth_sEc3">
3</a>&nbsp;&nbsp;Compiler plugins</h2>


<div class="p"><!----></div>
After the base X10 semantic checking is completed, 
compiler plugins are loaded and run.  Plugins may perform
any number of compiler passes to implement
additional semantic checking and code transformations, including
transformations using the abstract syntax of the annotations
themselves.  Plugins should output valid X10 abstract
syntax trees.

<div class="p"><!----></div>
Plugins are implemented in Java as
Polyglot&nbsp;[] passes applied to the AST
after normal base X10 type checking.
Plugins to run are specified on the command-line.  The order of
execution is determined by the Polyglot pass scheduler.


<div class="p"><!----></div>
To run compiler plugins, add the command-line option:

<pre>
&nbsp;&nbsp;-PLUGINS=P1,P2,...,Pn

</pre>
where <tt>P1</tt>, <tt>P2</tt>, ..., <tt>Pn</tt> are classes that implement the
<tt>CompilerPlugin</tt> interface:


<div class="p"><!----></div>
<pre>
package polyglot.ext.x10.plugin;

<div class="p"><!----></div>
import polyglot.ext.x10.ExtensionInfo;
import polyglot.frontend.Job;
import polyglot.frontend.goals.Goal;

<div class="p"><!----></div>
public interface CompilerPlugin {
  public Goal
    register(ExtensionInfo extInfo, Job job);
}
</pre>

<div class="p"><!----></div>
The <tt>Goal</tt> object returned by the <tt>register</tt> method specifies dependencies on other passes.
Documentation for Polyglot can be found at:

<pre>
http://www.cs.cornell.edu/Projects/polyglot

</pre>
Most plugins should implement either <tt>SimpleOnePassPlugin</tt> or
<tt>SimpleVisitorPlugin</tt>.

<div class="p"><!----></div>
The compiler loads plugin classes from the x10c classpath.

<div class="p"><!----></div>
Plugins are given access to a Polyglot AST and type system.  Annotations are
represented in the AST as <tt>Node</tt>s with the following interface:


<div class="p"><!----></div>

<pre>
package&nbsp;polyglot.ext.x10.ast;

public&nbsp;interface&nbsp;AnnotationNode&nbsp;extends&nbsp;Node&nbsp;{
&nbsp;&nbsp;X10ClassType&nbsp;annotation();
}

</pre>

<div class="p"><!----></div>
Annotations for a <tt>Node</tt> object <tt>n</tt> can be accessed through the
node's extension object as follows:


<div class="p"><!----></div>

<pre>
List&lt;AnnotationNode&#62;&nbsp;annotations&nbsp;=
&nbsp;&nbsp;((X10Ext)&nbsp;n.ext()).annotations();
List&lt;X10ClassType&#62;&nbsp;annotationTypes&nbsp;=
&nbsp;&nbsp;((X10Ext)&nbsp;n.ext()).annotationInterfaces();

</pre>
In the type system, <tt>X10TypeObject</tt> has the following
method for accessing annotations:

<pre>
List&lt;X10ClassType&#62;&nbsp;annotations();

</pre>

<div class="p"><!----></div>

<div class="p"><!----></div>

<div class="p"><!----></div>

</body>
</html>