<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<html>
<head>
<meta name="GENERATOR" content="TtH 3.80">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
 <style type="text/css"> div.p { margin-top: 7pt;}</style>
 <style type="text/css"><!--
 td div.comp { margin-top: -0.6ex; margin-bottom: -1ex;}
 td div.comb { margin-top: -0.6ex; margin-bottom: -.6ex;}
 td div.hrcomp { line-height: 0.9; margin-top: -0.8ex; margin-bottom: -1ex;}
 td div.norm {line-height:normal;}
 span.roman {font-family: serif; font-style: normal; font-weight: normal;} 
 span.overacc2 {position: relative;  left: .8em; top: -1.2ex;}
 span.overacc1 {position: relative;  left: .6em; top: -1.2ex;} --></style>
	<title>Dependent Types</title>
</head>

<body>
   <h2><a name="tth_sEc2">
2</a>&nbsp;&nbsp;Dependent types</h2><a name="DepType:DepType">
</a>

<div class="p"><!----></div>
A dependent type (deptype) is of the form <tt>C(: c)</tt> where <tt>C</tt> is a class
or interface, and <tt>c</tt> is a <em>constraint</em>. (<tt>C</tt> is said to be 
<em>the base type</em> of the deptype, and <tt>c</tt> the <em>constraint</em> of the deptype.)  A
constraint is a boolean expression that can only use a predefined set
of operators and methods. 

<div class="p"><!----></div>
<pre>
Type  ::=   PrimitiveType
          -  ClassOrInterfaceType
          -  ArrayType
          -  nullable &lt; Type &#62; DepParamtersopt
          -  future &lt; Type &#62; DepParametersopt
PrimitiveType ::= NumericType DepParametersopt
          -  boolean DepParametersopt
ClassOrInterfaceType   ::= 
  TypeName DepParametersopt PlaceTypeSpecifieropt
ClassType              ::= 
  TypeName DepParametersopt PlaceTypeSpecifieropt
InterfaceType          ::= 
  TypeName DepParametersopt PlaceTypeSpecifieropt
PlaceTypeSpecifier     ::=  ! PlaceTypeopt
PlaceType              ::= current  -  Expression

<div class="p"><!----></div>
DepParameters    ::= ( DepParameterExpr ) 
DepParameterExpr ::= ArgumentList WhereClauseopt
WhereClause      ::= : Constraint
Constraint       ::= Expression
ArgumentList     ::= Expression 
    -  ArgumentList , Expression
DepParametersopt ::= null  -  DepParameters
WhereClauseopt   ::= null  -  WhereClause
PlaceTypeopt     ::= null  -  PlaceType
</pre>

<div class="p"><!----></div>

<blockquote> Static Semantics: Variable Occurrence
  In a deptype T=C(:c), the only variables that may occur in c are (a)
  self, (b) properties visible at T, (c) final local variables, final
  method parameters or final constructor parameters visible at T, (d)
  final fields visible at T's lexical place in the source program.  
</blockquote>

<div class="p"><!----></div>

<blockquote> Static Semantics: This restrictions

<div class="p"><!----></div>
  The special variable <tt>this</tt> may be used in a depclause for a type <tt>T</tt>
  only if (a)&nbsp;it occurs in a property declaration for a class, (b)&nbsp;it
  occurs in an instance method, (c)&nbsp;it occurs in an instance field, (d)&nbsp;it
  occurs in an instance initializer.
</blockquote>

<div class="p"><!----></div>
In particular it may not be used in types that occur in a static
context, or in the arguments, body or return type of a constructor or
in the extends or implements clauses of class and interface
definitions.  In these contexts the object that <tt>this</tt> would
correspond to has either not been formed or is not well defined.

<div class="p"><!----></div>

<blockquote> Static Semantics: Variable visibility
  If a type <tt>T</tt> occurs in a field, method or constructor
  declaration, then all variables used in <tt>T</tt> must have at least the
  same visibility as the declaration.  The relation "at least the same
  visibility as" is given by the transitive closure of:

<div class="p"><!----></div>
  <pre>
public &#62; protected, protected &#62; private
public &#62; package, package &#62; private
</pre>

<div class="p"><!----></div>
All inherited properties of a type <tt>T</tt> are visible in the property
list of <tt>T</tt>, and the body of <tt>T</tt>.

<div class="p"><!----></div>
</blockquote>In general local variables/parameters/properties/fields are visible at
<tt>T</tt> if they are defined before <tt>T</tt> in the program. This rule applies to
types in property lists as well as parameter lists (for methods and
constructors).  An exception is made for the return type of a method:
all the arguments to the method are considered to be visible, even
though they occur lexically after the return type (given the Java
syntactic convention that the return type for a method precedes the
argument list for the method).

<div class="p"><!----></div>
We permit variable declarations <tt>T v</tt> where <tt>T</tt> is obtained
from a dependent type <tt>C(:c)</tt> by replacing one or more occurrences
of <tt>self</tt> in <tt>c</tt> by <tt>v</tt>. (If such a declaration <tt>T v</tt>
is type-correct, it must be the case that the variable <tt>v</tt> is not
visible at the type <tt>T</tt>. Hence we can always recover the
underlying deptype <tt>C(:c)</tt> by replacing all occurrences of <tt>v</tt>
in the constraint of <tt>T</tt> by <tt>self</tt>.)

<div class="p"><!----></div>
For instance, <tt>int(: v &#62; 0) v</tt> is shorthand for <tt>int(: self &#62; 0) v</tt>.

<blockquote>
 Static Semantics: Constraint type
  The type of c must be boolean.  
</blockquote>

<div class="p"><!----></div>
A variable occuring in the constraint <tt>c</tt> of a deptype, other than
<tt>self</tt> or a property of <tt>self</tt>, is said to be a <em>
parameter</em> of<tt>c</tt>.<a name="DepType:Parameter">
</a> 

<div class="p"><!----></div>
An instance <tt>o</tt> of <tt>C</tt> is said to be of type <tt>C (:c)</tt> (or: <em>belong to</em>
<tt>C(:c)</tt>) if the predicate <tt>c</tt> evaluates to <tt>true</tt> in the current lexical
environment, augmented with the binding <tt>[self  - -&#62; o]</tt>. We shall
use the function  <tt>C(:c)</tt>  to denote the set of objects that belong
to <tt>C(:c)</tt>. 
</body>
</html>