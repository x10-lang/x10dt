<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE project [<!ENTITY buildfile SYSTEM "file:./build-user.xml">]>
<project name="x10.dist.macosx.x86_64.fragment" default="update" basedir=".">
    &buildfile;
    <property name="tmp" location="${basedir}/tmp"/>
    <property name="incdir" location="${basedir}/include"/>
    <property name="lib" location="${basedir}/lib"/>
    <property name="x10.version" value="2.0.1"/>
    <property name="x10.timestamp" value="${x10.version}"/> <!-- override if version is, e.g., "svn head" -->
    <property name="x10.platform" value="macos_x86_64"/>
    <property name="x10.dist.location" location="${tmp}"/>
    <property name="pgas.location" location="${tmp}"/>
	<!-- start: changed for 2.0.1-->
	<property name="pgas.timestamp" value="20100113"/>
    <property name="pgas.tarball" value="pgas-${pgas.timestamp}-${x10.platform}_g++4-sockets.tgz"/> 
    <property name="pgas.tarball.url" value="http://dist.codehaus.org/x10/binaryReleases/${x10.version}/${pgas.tarball}"/> 
    <property name="x10.tarball" value="x10-${x10.timestamp}_${x10.platform}.tgz"/> 
    <property name="x10.tarball.url" value="http://sourceforge.net/projects/x10/files/${x10.version}/${x10.tarball}?use_mirror=voxel"/>
	<!-- end:   changed for 2.0.1-->
    <property name="x10.transport" value="sockets"/>
    <!-- get the environment variables -->
    <property environment="env"/>
    <target name="init">
        <tstamp/>
        <mkdir dir="${tmp}"/>
        <mkdir dir="${incdir}"/>
        <mkdir dir="${lib}"/>
        <condition property="pgas.already.expanded" value="true">
            <not>
                <equals arg1="${pgas.location}" arg2="${tmp}"/>
            </not>
        </condition>
        <condition property="local.pgas.tarball" value="${env.LOCAL_PGAS_TARBALL}">
            <or>
                <isset property="env.LOCAL_PGAS_TARBALL"/>
                <isset property="pgas.already.expanded"/>
            </or>
        </condition>
        <condition property="x10.already.expanded" value="true">
            <not>
                <equals arg1="${x10.dist.location}" arg2="${tmp}"/>
            </not>
        </condition>
        <condition property="local.x10.tarball" value="${env.LOCAL_X10_TARBALL}">
            <or>
                <isset property="env.LOCAL_X10_TARBALL"/>
                <isset property="x10.already.expanded"/>
            </or>
        </condition>
    </target>
    <target name="clean">
        <delete>
            <fileset dir="${lib}">
                <include name="lib*pgas*.a"/> ,<!-- changed for 2.0.1 -->
                <include name="libx10.a"/>
                <include name="libx10.mft"/>
                <include name="libgc.a"/>
                <exclude name="dummy.file"/>
            </fileset>
        </delete>
        <delete>
            <fileset dir="${incdir}">
                <include name="*.h"/>
                <include name="**/*.h"/>
                <include name="*.inc"/>
                <include name="**/*.inc"/>
                <exclude name="dummy.file"/>
            </fileset>
        </delete>
        <delete dir="${incdir}/x10"/>
        <delete dir="${incdir}/x10aux"/>
        <delete dir="${tmp}/include"/>
        <delete dir="${tmp}/lib"/>
    </target>
    <target name="distclean" depends="clean">
        <delete dir="${tmp}"/>
    </target>
    <target name="pgas-tarball-download" depends="init" unless="local.pgas.tarball">
        <mkdir dir="${tmp}"/>
        <get usetimestamp="true" ignoreerrors="true" src="${pgas.tarball.url}" dest="${tmp}/${pgas.tarball}"/>
        <property name="local.pgas.tarball" location="${tmp}/${pgas.tarball}"/>
    </target>
    <target name="expand-pgas-tarball" depends="init,pgas-tarball-download" unless="pgas.already.expanded">
    	<!--
        <untar src="${local.pgas.tarball}" dest="${tmp}" compression="gzip">
            <patternset>
                <include name="lib/libxlpgas_${x10.transport}.a"/>
            </patternset>
        </untar>  changed for 2.0.1 (omit)
    	-->
    </target>
    <target name="x10-tarball-download" depends="init" unless="local.x10.tarball">
        <mkdir dir="${tmp}"/>
        <get usetimestamp="true" ignoreerrors="true" src="${x10.tarball.url}" dest="${tmp}/${x10.tarball}"/>
        <property name="local.x10.tarball" location="${tmp}/${x10.tarball}"/>
    </target>
    <target name="expand-x10-tarball" depends="init,x10-tarball-download" unless="x10.already.expanded">
        <untar src="${local.x10.tarball}" dest="${tmp}" compression="gzip">
            <patternset>
                <include name="include/**"/>
                <include name="lib/libx10.a"/>
                <include name="lib/libx10.mft"/>
                <include name="lib/libgc.a"/>
            	<include name="lib/libx10rt_pgas_sockets.a"/> <!-- added/changed for 2.0.1 -->
            </patternset>
        </untar>
    </target>
    <target name="download" depends="init,pgas-tarball-download,x10-tarball-download"/>
    <target name="expand" depends="init,expand-pgas-tarball,expand-x10-tarball"/>
    <target name="update" depends="init,expand">
        <echo message="${ant.project.name}: ${ant.file}"/>
        <copy todir="${incdir}">
            <fileset dir="${x10.dist.location}/include" includes="**"/>
        </copy>
        <copy todir="${lib}">
            <fileset dir="${x10.dist.location}/lib" includes="libx10.a,libx10.mft,libgc.a,libx10rt_pgas_sockets.a"/><!-- 2.0.1-->
            <!-- <fileset dir="${pgas.location}/lib" includes="libxlpgas_${x10.transport}.a"/> omit for 2.0.1 -->
        </copy>
    </target>
    <target name="dist" depends="init,update"/>
</project>
<!-- vim:tabstop=4:shiftwidth=4:expandtab
-->
