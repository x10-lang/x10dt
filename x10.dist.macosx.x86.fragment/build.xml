<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE project [<!ENTITY buildfile SYSTEM "file:./build-user.xml">]>
<project name="x10.dist.macosx.x86.fragment" default="update" basedir=".">
    &buildfile;
    <property name="tmp" location="${basedir}/tmp"/>
    <property name="incdir" location="${basedir}/include"/>
    <property name="lib" location="${basedir}/lib"/>
    <property name="x10.version" value="2.0.0"/>
    <property name="x10.timestamp" value="${x10.version}"/> <!-- override if version is, e.g., "svn head" -->
    <property name="x10.platform" value="macos_x86"/>
    <property name="x10.dist.location" location="${tmp}"/>
    <property name="pgas.tarball" value="pgas-${x10.timestamp}_${x10.platform}.tgz"/>
    <property name="pgas.tarball.url" value="http://dist.codehaus.org/x10/binaryReleases/${x10.version}/${pgas.tarball}"/>
    <property name="x10.tarball" value="x10-${x10.timestamp}_${x10.platform}.tgz"/>
    <property name="x10.tarball.url" value="http://downloads.sourceforge.net/project/x10/x10/${x10.version}/${x10.tarball}?use_mirror=voxel"/>
    <property name="x10.transport" value="sockets"/>
    <!-- get the environment variables -->
    <property environment="env"/>
    <target name="init">
        <tstamp/>
        <mkdir dir="${tmp}"/>
        <mkdir dir="${incdir}"/>
        <mkdir dir="${lib}"/>
        <condition property="local.pgas.tarball" value="${env.LOCAL_PGAS_TARBALL}">
            <isset property="env.LOCAL_PGAS_TARBALL"/>
        </condition>
        <condition property="local.x10.tarball" value="${env.LOCAL_X10_TARBALL}">
            <isset property="env.LOCAL_X10_TARBALL"/>
        </condition>
    </target>
    <target name="clean">
        <delete>
            <fileset dir="${lib}">
                <include name="libxlpgas_${x10.transport}.a"/>
                <include name="libx10.a"/>
                <include name="libx10.mft"/>
                <include name="libgc.a"/>
                <exclude name="dummy.file"/>
            </fileset>
        </delete>
        <delete>
            <fileset dir="${incdir}">
                <include name="*.h"/>
		<include name="**/*.h"/>
                <include name="*.inc"/>
		<include name="**/*.inc"/>
                <exclude name="dummy.file"/>
            </fileset>
        </delete>
        <delete dir="${incdir}/x10"/>
        <delete dir="${incdir}/x10aux"/>
        <delete dir="${tmp}/include"/>
        <delete dir="${tmp}/lib"/>
    </target>
    <target name="distclean" depends="clean">
        <delete dir="${tmp}"/>
    </target>
    <target name="pgas-tar" depends="init" unless="local.pgas.tarball">
        <mkdir dir="${tmp}"/>
        <get usetimestamp="true" ignoreerrors="true" src="${pgas.tarball.url}" dest="${tmp}/${pgas.tarball}"/>
        <untar src="${tmp}/${pgas.tarball}" dest="${tmp}" compression="gzip">
            <patternset>
                <include name="lib/libxlpgas_${x10.transport}.a"/>
            </patternset>
        </untar>
    </target>
    <target name="x10-tar" depends="init" unless="local.x10.tarball">
        <mkdir dir="${tmp}"/>
        <get usetimestamp="true" ignoreerrors="true" src="${x10.tarball.url}" dest="${tmp}/${x10.tarball}"/>
        <untar src="${tmp}/${x10.tarball}" dest="${tmp}" compression="gzip">
            <patternset>
                <include name="include/**"/>
                <include name="lib/libx10.a"/>
                <include name="lib/libx10.mft"/>
                <include name="lib/libgc.a"/>
            </patternset>
        </untar>
    </target>
    <target name="download" depends="init,pgas-tar,x10-tar"/>
    <target name="update" depends="init,download">
        <echo message="${ant.project.name}: ${ant.file}"/>
        <copy todir="${incdir}">
            <fileset dir="${tmp}/include" includes="**"/>
        </copy>
        <copy todir="${lib}">
            <fileset dir="${tmp}/lib" includes="**"/>
        </copy>
    </target>
    <target name="dist" depends="init,update"/>
</project>
