<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<html>
<head>
<meta name="GENERATOR" content="TtH 3.80">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
 <style type="text/css"> div.p { margin-top: 7pt;}</style>
 <style type="text/css"><!--
 td div.comp { margin-top: -0.6ex; margin-bottom: -1ex;}
 td div.comb { margin-top: -0.6ex; margin-bottom: -.6ex;}
 td div.hrcomp { line-height: 0.9; margin-top: -0.8ex; margin-bottom: -1ex;}
 td div.norm {line-height:normal;}
 span.roman {font-family: serif; font-style: normal; font-weight: normal;} 
 span.overacc2 {position: relative;  left: .8em; top: -1.2ex;}
 span.overacc1 {position: relative;  left: .6em; top: -1.2ex;} --></style>
	<title>Spawning an Activity</title>
</head>

<body>
 <h2><a name="tth_sEc2">
2</a>&nbsp;&nbsp;Spawning an activity</h2><a name="AsynchronousActivity">
</a><a name="AsyncActivity">
</a>

<div class="p"><!----></div>
Asynchronous activities serve as a single abstraction for supporting a
wide range of concurrency constructs such as message passing, threads,
DMA, streaming, data prefetching. (In general, asynchronous operations
are better suited for supporting scalability than synchronous
operations.)

<div class="p"><!----></div>
An activity is created by executing the statement:
<pre>
463 Statement ::= AsyncStatement
473 StatementNoShortIf ::= AsyncStatementNoShortIf
481 AsyncStatement ::= 
      async PlaceExpressionSingleListopt Statement
491 AsyncStatementNoShortIf ::= 
      async PlaceExpressionSingleListopt 
         StatementNoShortIf
524   PlaceExpressionSingleListopt ::=
525        -  PlaceExpressionSingleList
499   PlaceExpressionSingleList ::= 
         ( PlaceExpression )
500   PlaceExpression ::= Expression
</pre>

<div class="p"><!----></div>
The place expression <tt>e</tt> is expected to be of type <tt>place</tt>,
e.g. <tt>here</tt> or <tt>place.FIRST_PLACE</tt> or <tt>d[p]</tt> for some
distribution <tt>d</tt> and point <tt>p</tt> (&#167;&nbsp;).  
If not, the compiler replaces
<tt>e</tt> with <tt>e.location</tt>. (Recall that every expression in
 X10 has a type; this type is a subtype of the root class <tt>
x10.lang.Object</tt>.  This class has a field <tt>location</tt> of type <tt>
place</tt> recording the place at which the value resides. See
the documentation for <tt>x10.lang.Object</tt>.)

<div class="p"><!----></div>
Note specifically that the expression <tt>a[i]</tt> when used as a place
expression will evaluate to <tt>a[i].location</tt>, which may not be
the same place as <tt>a.distribution[i]</tt>. The programmer must be 
careful to choose the right expression, appropriate for the statement.
Accesses to <tt>a[i]</tt> within <tt>Statement</tt> should typically be guarded 
by the place expression <tt>a.distribution[i]</tt>.

<div class="p"><!----></div>
In many cases the compiler may infer the unique place at which the
statement is to be executed by an analysis of the types of the
variables occuring in the statement. (The place must be such that the
statement can be executed safetly, without generating a <tt>
BadPlaceException</tt>.) In such cases the programmer may omit the place
designator; the compiler will throw an error if it cannot 
determine the unique designated place.<a href="#tthFtNtAAD" name="tthFrefAAD"><sup>3</sup></a>

<div class="p"><!----></div>
An activity A executes the statement <tt>async (P) S</tt> by launching
a new activity B at the designated place, to execute the specified
statement. The statement terminates locally as soon as B is
launched.  The activation path for B is that of A, augmented with
information about the line number at which B was spawned.  B
terminates normally when S terminates normally.  It terminates
abruptly if S throws an (uncaught) exception. The exception is
propagated to A if A is a root activity (see &#167;&nbsp;),
otherwise through A to A's root activity. Note that while an
activity is running, exceptions thrown by activities it has already
generated may propagate through it up to its root activity.

<div class="p"><!----></div>
Multiple activities launched by a single activity at another place are
not ordered in any way. They are added to the pool of activities at
the target place and will be executed in sequence or in parallel based
on the local scheduler's decisions. If the programmer wishes to
sequence their execution s/he must use  X10 constructs, such as
clocks and <tt>finish</tt> to obtain the desired effect.  Further, the
 X10 implementations are not required to have fair schedulers,
though every implementation should make a best faith effort to ensure
that every activity eventually gets a chance to make forward progress.

<div class="p"><!----></div>

<b>Static semantics.&nbsp;&nbsp;</b>
The statement in the body of an <tt>async</tt> is subject to the
restriction that it must be acceptable as the body of a <tt>void</tt>
method for an anoymous inner class declared at that point in the code,
which throws no checked exceptions. As such, it may reference
variables in lexically enclosing scopes (including <tt>clock</tt>
variables, &#167;&nbsp;) provided that such variables are
(implicitly or explicitly) <tt>final</tt>.
</body>
</html>