<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<html>
<head>
<meta name="GENERATOR" content="TtH 3.80">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
 <style type="text/css"> div.p { margin-top: 7pt;}</style>
 <style type="text/css"><!--
 td div.comp { margin-top: -0.6ex; margin-bottom: -1ex;}
 td div.comb { margin-top: -0.6ex; margin-bottom: -.6ex;}
 td div.hrcomp { line-height: 0.9; margin-top: -0.8ex; margin-bottom: -1ex;}
 td div.norm {line-height:normal;}
 span.roman {font-family: serif; font-style: normal; font-weight: normal;} 
 span.overacc2 {position: relative;  left: .8em; top: -1.2ex;}
 span.overacc1 {position: relative;  left: .6em; top: -1.2ex;} --></style>
<title>Function literals</title>
</head>

<body>
 <h2><a name="tth_sEc2">
2</a>&nbsp;&nbsp;Function Literals</h2>

<a name="FunctionLiteral">
</a>

<div class="p"><!----></div>
X10 provides first-class, typed functions, including
<em>closures</em>, <em>operator functions</em>, and <em>method
  selectors</em>.

<div class="p"><!----></div>
  :  |        <em>  
<table>
<tr><td align="right">ClosureExpression &nbsp;
        "("
        Formals<sup>?</sup>&nbsp;
")"
</td></tr>
<tr><td align="right">&amp;&amp;
        Guard<sup>?</sup>&nbsp;
ReturnType<sup>?</sup>&nbsp;
Throws<sup>?</sup>&nbsp;
"=&#62;" ClosureBody </td></tr>
<tr><td align="right">ClosureBody &nbsp;
        Expression </td></tr>
<tr><td align="right">\ -  "{" Statement<sup>*</sup>&nbsp;"}" </td></tr>
<tr><td align="right">\ -  "{" Statement<sup>*</sup>&nbsp;Expression "}" </td></tr>
<tr><td align="right"></td></tr></table>
</em>

<div class="p"><!----></div>
Functions have zero or more formal parameters, an optional return type
and optional set of exceptions throws by the body.  The body has the
same syntax as a method body; it may be either an expression, a block
of statements, or a block terminated by an expression to return. In
particular, a value may be returned from the body of the function
using a return statement (&#167;). The type of a
function is a function type (&#167;).  In some cases the
return type "T" is also optional and defaults to the type of the
body. If a formal "xi" does not occur in any
"Tj","c","T" or "e", the declaration "xi:Ti" may
be replaced by just "Ti".

<div class="p"><!----></div>
<a name="ClosureGuard">
</a>As with methods, a function may declare a guard to
constrain the actual parameters with which it may be invoked.
The guard may refer to the type parameters, formal parameters,
and any final variables in scope at the function expression.

<div class="p"><!----></div>
The body of the function is evaluated when the function is
invoked by a call expression (&#167;), not at the function's
place in the program text.

<div class="p"><!----></div>
As with methods, a function with return type "Void" cannot
have a terminating expression. 
If the return type is omitted, it is inferred, as described in
&#167;.
It is a static error if the return type cannot be inferred. 

<div class="p"><!----></div>
The following method takes a function parameter and uses it to
test each element of the list, returning the first matching
element.
<pre>
def find[T](f: (T) =&#62; Boolean, xs: List[T]): T = {
  for (x: T in xs)
    if (f(x)) return x;
  null
}
</pre>

<div class="p"><!----></div>
The method may be invoked thus:
<pre>
xs: List[Int] = ...;
x: Int = find((x: Int) =&#62; x&#62;0, xs);
</pre>


<div class="p"><!----></div>
As with a normal method, the function may have a "throws"
clause. It is a static error if the body of the function throws a
checked exception that is not declared in the function's "throws"
clause.

<div class="p"><!----></div>
     <h3><a name="tth_sEc2.1">
2.1</a>&nbsp;&nbsp;Outer variable access</h3>

<div class="p"><!----></div>
In a function
"(x<sub>1</sub>: T<sub>1</sub>, ..., x<sub>n</sub>: T<sub>n</sub>){c} =&#62; { s }"
the types "T<sub>i</sub>", the guard "c" and the body "s"
may access fields of enclosing classes and local variables and type
parameters declared in an outer scope.

<div class="p"><!----></div>
Recall that languages such as Java require that methods may
access only those local variables declared in an enclosing scope
("outer variables") which are final. This is valuable in
preventing accidental races between multiple functions reading
and writing the same outer variable. At the same time, it is
desirable to support the following common idiom of expression:

<div class="p"><!----></div>
<pre>
def allPositive(c: Collection): Boolean {
  shared var result: Boolean = true;
  c.applyToAll((x: Int) =&#62; { if (x &lt; 0) atomic {result=false;}});
  return result;
}
</pre>

<div class="p"><!----></div>
This motivates the following rule:

<div class="p"><!----></div>
 S<font size="-2">TATIC</font> S<font size="-2">EMANTICS</font> R<font size="-2">ULE</font>:
In an expression
"(x<sub>1</sub>: T<sub>1</sub>, ..., x<sub>n</sub>: T<sub>n</sub>) =&#62; e",
any outer local variable accessed by "e" must be final or
must be declared
as "shared" (&#167;).


<div class="p"><!----></div>
The function body may refer to instances of enclosing classes using
the syntax "C.this", where "C" is the name of the
enclosing class.

<div class="p"><!----></div>
 Note:
The main activity may run in parallel with any
functions it creates. Hence even the read of an outer variable by the
body of a function may result in a race condition. Since functions are
first-class, the analysis of whether a function may execute in parallel
with the activity that created it may be difficult.


<div class="p"><!----></div>

<div class="p"><!----></div>

</body>
</html>